<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Prompts - Prompts Library</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    
    <link href="{{ url_for('static', filename='css/pixel-gallery.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
</head>
<body class="pixel-theme">
    
    <!-- Pixel Header -->
    <header class="pixel-header">
        <a href="{{ url_for('index') }}" class="pixel-logo">
            <img src="{{ url_for('static', filename='images/eagle-logo.jpg') }}" alt="Prompts Library Logo">
            <span>Prompts-Library</span>
        </a>
        <nav class="pixel-nav">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('gallery') }}">Explore</a>
            {% if current_user.is_authenticated and current_user.is_admin %}
                <a href="{{ url_for('add_prompt') }}">Upload</a>
                <a href="{{ url_for('my_prompts') }}" class="active">My Prompts</a>
                <a href="{{ url_for('saved_prompts') }}">Saved</a>
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('admin_users') }}">Admin</a>
                <a href="{{ url_for('logout') }}">Logout</a>
            {% endif %}
        </nav>
    </header>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="pixel-container" style="padding-top: 1rem;">
                {% for category, message in messages %}
                    <div style="padding: 1rem; margin-bottom: 1rem; background: rgba(157, 78, 221, 0.2); border: 2px solid var(--pixel-purple); border-radius: 8px; font-family: 'VT323', monospace; font-size: 1.1rem;">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <div class="pixel-container">
    {% if current_user.is_admin %}
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div>
                <h1 class="page-title">My Prompts</h1>
                <p class="page-subtitle">Manage your created prompts</p>
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <!-- Category Filter -->
                <div style="position: relative;">
                    <select onchange="window.location.href='{{ url_for('my_prompts') }}?category=' + this.value"
                            style="padding: 0.8rem 2.5rem 0.8rem 1rem; font-family: 'VT323', monospace; font-size: 1.1rem; background: rgba(11, 11, 16, 0.9); border: 2px solid var(--pixel-purple); border-radius: 8px; color: var(--pixel-white); cursor: pointer; appearance: none; min-width: 200px;">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <i class="fas fa-chevron-down" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: var(--pixel-purple); pointer-events: none;"></i>
                </div>
                
                <a href="{{ url_for('add_prompt') }}" class="pixel-btn pixel-btn-primary" style="white-space: nowrap;">
                    <i class="fas fa-plus"></i> Add Prompt
                </a>
            </div>
        </div>

        <!-- Prompts Grid -->
        <div class="prompt-grid">
            {% for prompt in prompts %}
                <div class="pixel-prompt-card">
                    <div class="card-image-container">
                        <img src="{{ prompt.image_url }}" alt="{{ prompt.title }}" class="card-image" loading="lazy">
                        <div class="pixel-category-badge">{{ prompt.category.name }}</div>
                        <div class="card-overlay">
                            <h3 class="card-title">{{ prompt.title }}</h3>
                            <p class="card-creator">Created: {{ prompt.created_at.strftime('%b %d, %Y') }}</p>
                        </div>
                    </div>
                    <div style="padding: 1rem; background: rgba(26, 26, 31, 0.8); border-top: 2px solid var(--pixel-purple);">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;">
                            <button onclick="viewPrompt('{{ prompt.id }}')" class="pixel-btn" style="font-size: 0.9rem; padding: 0.6rem;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button onclick="editPrompt('{{ prompt.id }}')" class="pixel-btn" style="font-size: 0.9rem; padding: 0.6rem; background: var(--pixel-purple);">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deletePrompt('{{ prompt.id }}')" class="pixel-btn" style="font-size: 0.9rem; padding: 0.6rem; background: var(--pixel-red);">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Empty State -->
        {% if not prompts %}
            <div class="empty-state" style="text-align: center; padding: 4rem 2rem;">
                <div style="font-size: 4rem; color: var(--pixel-purple); margin-bottom: 1.5rem;">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 style="font-family: 'Press Start 2P', cursive; font-size: 1.2rem; color: var(--pixel-white); margin-bottom: 1rem;">
                    No prompts yet
                </h3>
                <p style="font-family: 'VT323', monospace; font-size: 1.2rem; color: rgba(248, 249, 250, 0.7); margin-bottom: 2rem;">
                    You haven't created any prompts yet. Start by adding your first prompt!
                </p>
                <a href="{{ url_for('add_prompt') }}" class="pixel-btn pixel-btn-primary" style="padding: 1rem 2rem;">
                    <i class="fas fa-plus"></i> Add First Prompt
                </a>
            </div>
        {% endif %}
        {% else %}
            <div style="text-align: center; padding: 4rem 2rem;">
                <div style="font-size: 4rem; color: var(--pixel-red); margin-bottom: 1.5rem;">
                    <i class="fas fa-lock"></i>
                </div>
                <h3 style="font-family: 'Press Start 2P', cursive; font-size: 1.2rem; color: var(--pixel-white); margin-bottom: 1rem;">
                    Access Denied
                </h3>
                <p style="font-family: 'VT323', monospace; font-size: 1.2rem; color: rgba(248, 249, 250, 0.7);">
                    You are not authorized to access this page.
                </p>
            </div>
        {% endif %}
    </div>

    <!-- Mobile Bottom Navbar -->
    <nav class="mobile-navbar">
        <a href="{{ url_for('index') }}">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <span>Home</span>
        </a>
        <a href="{{ url_for('gallery') }}">
            <div class="nav-icon"><i class="fas fa-th"></i></div>
            <span>Explore</span>
        </a>
        {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('add_prompt') }}">
                <div class="nav-icon"><i class="fas fa-plus"></i></div>
                <span>Upload</span>
            </a>
        {% endif %}
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('saved_prompts') }}">
                <div class="nav-icon"><i class="fas fa-bookmark"></i></div>
                <span>Saved</span>
            </a>
            <a href="{{ url_for('profile') }}">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <span>Profile</span>
            </a>
        {% else %}
            <a href="{{ url_for('login') }}">
                <div class="nav-icon"><i class="fas fa-sign-in-alt"></i></div>
                <span>Login</span>
            </a>
        {% endif %}
    </nav>

    <script>
        function viewPrompt(promptId) {
            window.location.href = `/prompt/${promptId}`;
        }

        function editPrompt(promptId) {
            fetch(`/api/prompts/${promptId}`)
                .then(response => response.json())
                .then(data => {
                    // Populate edit modal (reusing existing modal from base.html if available)
                    // Or redirect to edit page
                    window.location.href = `/prompts/${promptId}/edit`;
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading prompt details');
                });
        }

        function deletePrompt(promptId) {
            if (confirm('Are you sure you want to delete this prompt? This action cannot be undone.')) {
                fetch(`/api/prompts/${promptId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert(data.message || 'Error deleting prompt');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting prompt');
                });
            }
        }
    </script>
</body>
</html>
